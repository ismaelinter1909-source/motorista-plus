<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Painel Motorista — Motorista Plus</title>

<style>
  :root{
    --bg:#0b0f14;
    --bg2:#10161d;
    --card:rgba(16,22,29,.86);
    --primary:#f39220;
    --primary-700:#d47e16;
    --outline:#2b3a49;
    --text:#fff;
  }

  *{margin:0;padding:0;box-sizing:border-box;font-family:system-ui,Arial;}

  body{background:var(--bg);color:var(--text);overflow-x:hidden;}

  #abrirMenu{
    position:fixed; top:15px; left:15px;
    padding:10px 14px; background:var(--primary);
    border:none; border-radius:8px; color:#fff; font-weight:700;
    cursor:pointer; z-index:9999; transition:.25s;
  }
  #abrirMenu:hover{ background:var(--primary-700); transform:scale(1.05); }

  .menu-lateral{
    position:fixed; top:0; left:-330px; width:300px; height:100vh;
    background:var(--bg2); padding:20px; border-right:1px solid var(--outline);
    transition:.3s; z-index:9998;
  }
  .menu-lateral.active{ left:0; }
  .menu-lateral h3{ text-align:center; color:var(--primary); margin-bottom:10px; }
  .menu-lateral input{
    width:100%; padding:12px; margin-top:6px; border-radius:10px;
    background:#0f141a; border:1px solid var(--outline); color:white;
  }
  .menu-lateral button{
    margin-top:12px; padding:12px; border:none; background:var(--primary);
    color:white; font-weight:700; border-radius:10px; cursor:pointer; transition:.25s;
  }
  .menu-lateral button:hover{ background:var(--primary-700); transform:scale(1.05); }

  header.hero{
    height:70vh;
    background:
      linear-gradient(180deg,rgba(0,0,0,.35),rgba(0,0,0,.85)),
      url("img/Logo.Motorista-Plus.png") center/cover no-repeat;
    display:flex; flex-direction:column; align-items:center; justify-content:center;
    text-align:center; padding:20px;
  }

  .brand{ font-size:clamp(38px,6vw,60px); font-weight:800; }
  .brand .plus{ color:var(--primary); }

  .slogan{ font-size:clamp(14px,2vw,20px); letter-spacing:.15em; margin-bottom:20px; opacity:.9; }

  .card-perfil{
    background:var(--card); border:1px solid var(--outline); border-radius:16px;
    padding:22px; width:min(90%,450px); backdrop-filter:blur(6px);
    box-shadow:0 10px 35px rgba(0,0,0,.35);
  }

  /* === Avatar sempre quadrado e preenchido === */
  .avatar{
    width:140px; aspect-ratio:1/1; /* garante quadrado em qualquer lugar */
    border-radius:50%; overflow:hidden; margin:0 auto 12px auto;
    border:3px solid var(--primary);
  }
  .avatar img{
    width:100%; height:100%; object-fit:cover; object-position:center;
    display:block;
  }

  .btnFoto{
    background:var(--primary); color:white; border:none; padding:8px 14px;
    border-radius:10px; font-weight:700; display:block; margin:0 auto 18px auto;
    cursor:pointer; transition:.25s;
  }
  .btnFoto:hover{ background:var(--primary-700); transform:scale(1.05); }

  .info{
    background:rgba(255,255,255,.06); border:1px solid var(--outline);
    padding:10px; margin:8px 0; border-radius:10px;
  }

  .conteudo{ max-width:1100px; margin:40px auto; padding:20px; }

  .titulo-sessao{ text-align:center; font-size:22px; color:var(--primary); margin-bottom:20px; font-weight:800; }

  .links-grid{
    display:grid; grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
    gap:18px;
  }

  /* === Cards com hover/active elegante === */
  .links-grid a{
    display:flex; flex-direction:column; align-items:center; gap:12px;
    background:var(--card); border:1px solid var(--outline); padding:22px;
    border-radius:16px; text-decoration:none; color:white; font-size:18px; font-weight:700;
    transition: transform .18s ease, box-shadow .18s ease, background .2s ease, border-color .2s ease;
    will-change: transform;
  }
  .links-grid a:hover{
    transform: translateY(-4px) scale(1.03);
    box-shadow: 0 12px 30px rgba(0,0,0,.35);
    background: rgba(255,255,255,.04);
    border-color: rgba(255,255,255,.18);
  }
  /* feedback em toque (mobile) */
  .links-grid a:active{ transform:scale(0.98); }

  /* Acessibilidade */
  .links-grid a:focus-visible{
    outline: 3px solid rgba(243,146,32,.6);
    outline-offset: 3px;
  }

  .card-icon{ width:48px; height:48px; fill:white; }

  #logoutBtn{
    margin:40px auto; background:#d94343; padding:14px 20px; border-radius:12px;
    color:white; border:none; font-weight:700; cursor:pointer; transition:.25s;
    display:block; width:220px;
  }
  #logoutBtn:hover{ background:#b93636; transform:scale(1.05); }

  /* Evita animações para quem prefere movimento reduzido */
  @media (prefers-reduced-motion: reduce){
    .links-grid a{ transition:none; }
    #abrirMenu, .menu-lateral button, .btnFoto, #logoutBtn{ transition:none; }
  }
</style>
</head>
<body>

<button id="abrirMenu">Perfil</button>

<div class="menu-lateral" id="menuLateral">
  <h3>Editar Perfil</h3>

  <label>Nome</label>
  <input id="editarNome" autocomplete="name">

  <label>Telefone</label>
  <input id="editarTelefone" inputmode="tel" autocomplete="tel">

  <label>Placa Cavalo</label>
  <input id="editarPlacaCavalo">

  <label>Placa Reboque</label>
  <input id="editarPlacaReboque">

  <label>Email</label>
  <input id="editarEmail" autocomplete="email">

  <button id="salvarPerfil">Salvar</button>
</div>

<header class="hero">
  <h1 class="brand">Motorista<span class="plus">Plus</span></h1>
  <p class="slogan">SEMPRE EM MOVIMENTO</p>

  <div class="card-perfil">
    <div class="avatar">
      <img src="img/perfil-padrao.png" id="fotoPerfil" alt="Foto do perfil">
    </div>
    <button id="trocarFoto" class="btnFoto">Trocar Foto</button>
    <input type="file" id="inputFoto" accept="image/*" style="display:none;">

    <h2 id="boasVindas" style="text-align:center;">Bem-vindo(a)</h2>

    <div class="info" id="userNome"></div>
    <div class="info" id="userTelefone"></div>
    <div class="info" id="userPlacaCavalo"></div>
    <div class="info" id="userPlacaReboque"></div>
    <div class="info" id="userEmail"></div>
  </div>
</header>

<div class="conteudo">
  <h2 class="titulo-sessao">Planilhas de Viagem</h2>

  <div class="links-grid">

    <a href="media.html" aria-label="Abrir planilha de Média">
      <svg class="card-icon" viewBox="0 0 24 24" role="img" aria-hidden="true">
        <path d="M3 3h2v18H3zM9 13h2v8H9zM15 8h2v13h-2zM21 3h-2v18h2z"/>
      </svg>Média
    </a>

    <a href="abastecimentos.html" aria-label="Abrir planilha de Abastecimento">
      <svg class="card-icon" viewBox="0 0 24 24" role="img" aria-hidden="true">
        <path d="M3 3h10v18H3zM18 6l3 3v9a3 3 0 1 1-6 0v-7h2v7a1 1 0 1 0 2 0V10l-2-2z"/>
      </svg>Abastecimento
    </a>

    <a href="gastos.html" aria-label="Abrir planilha de Gastos">
      <svg class="card-icon" viewBox="0 0 24 24" role="img" aria-hidden="true">
        <path d="M2 7h20v10H2zm3 3v4h14v-4z"/>
      </svg>Gastos
    </a>

    <a href="viagem.html" aria-label="Abrir planilha de Viagem">
      <svg class="card-icon" viewBox="0 0 24 24" role="img" aria-hidden="true">
        <path d="M12 2l7 7-7 7-7-7z"/>
      </svg>Viagem
    </a>

    <a href="entregas.html" aria-label="Abrir planilha de Entregas">
      <svg class="card-icon" viewBox="0 0 24 24" role="img" aria-hidden="true">
        <path d="M3 5h13v14H3zM16 8h4l1 3v8h-5z"/>
      </svg>Entregas
    </a>

    <a href="manutencao.html" aria-label="Abrir planilha de Manutenção">
      <svg class="card-icon" viewBox="0 0 24 24" role="img" aria-hidden="true">
        <path d="M12 9a3 3 0 1 1 0 6 3 3 0 0 1 0-6zm9.4 6.2a8 8 0 0 0 .1-3.4l2-1.6-1.5-2.6-2.3.6a8 8 0 0 0-2.4-1.4L16.7 2h-3.4l-.6 2.4a8 8 0 0 0-2.4 1.4l-2.3-.6L5 6.6l2 1.6a8 8 0 0 0 0 3.4l-2 1.6L6.5 17l2.3-.6a8 8 0 0 0 2.4 1.4l.6 2.4h3.4l.6-2.4a8 8 0 0 0 2.4-1.4l2.3.6 1.5-2.6z"/>
      </svg>Manutenção
    </a>

    <a href="ponto.html" aria-label="Abrir Registro de Ponto">
      <svg class="card-icon" viewBox="0 0 24 24" role="img" aria-hidden="true">
        <path d="M12 1a11 11 0 1 1 0 22A11 11 0 0 1 12 1zm1 6h-2v7h6v-2h-4z"/>
      </svg>Ponto
    </a>

  </div>

  <button id="logoutBtn">Sair</button>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
  import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
  import { getFirestore, doc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

  /* ✅ CONFIG — motorista-plus-c53f4 */
  const firebaseConfig = {
    apiKey: "AIzaSyCnlpnTTJvJPZxuZdmpKQWbbHtvH72nMUU",
    authDomain: "motorista-plus-c53f4.firebaseapp.com",
    projectId: "motorista-plus-c53f4",
    storageBucket: "motorista-plus-c53f4.appspot.com",
    messagingSenderId: "766097061342",
    appId: "1:766097061342:web:36d999bec6d9fe8c46994f"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  const menu = document.getElementById("menuLateral");
  const abrirMenu = document.getElementById("abrirMenu");
  abrirMenu.onclick = ()=> menu.classList.toggle("active");

  onAuthStateChanged(auth, async user=>{
    if(!user){ window.location.href="login.html"; return; }

    const ref = doc(db,"usuarios",user.uid);
    const snap = await getDoc(ref);
    if(!snap.exists()){ alert("Erro ao carregar perfil."); return; }

    const u = snap.data();

    boasVindas.textContent = "Bem-vindo(a), " + (u.nome || "Motorista");

    userNome.textContent = "Nome: " + (u.nome ?? "—");
    userTelefone.textContent = "Telefone: " + (u.telefone ?? "—");
    userPlacaCavalo.textContent = "Placa Cavalo: " + (u.placaCavalo ?? "—");
    userPlacaReboque.textContent = "Placa Reboque: " + (u.placaReboque ?? "—");
    userEmail.textContent = "Email: " + (u.email ?? "—");

    if(u.foto){ fotoPerfil.src = u.foto; }

    editarNome.value = u.nome ?? "";
    editarTelefone.value = u.telefone ?? "";
    editarPlacaCavalo.value = u.placaCavalo ?? "";
    editarPlacaReboque.value = u.placaReboque ?? "";
    editarEmail.value = u.email ?? "";

    salvarPerfil.onclick = async ()=>{
      await updateDoc(ref,{
        nome:editarNome.value,
        telefone:editarTelefone.value,
        placaCavalo:editarPlacaCavalo.value,
        placaReboque:editarPlacaReboque.value,
        email:editarEmail.value
      });
      alert("Perfil atualizado!");
      location.reload();
    };
  });

  trocarFoto.onclick = ()=> inputFoto.click();

  /* === Automação do avatar: recorta e redimensiona para 512x512 === */
  inputFoto.onchange = async e=>{
    const file = e.target.files?.[0];
    if(!file) return;

    // Lê arquivo
    const dataURL = await new Promise((res, rej)=>{
      const r = new FileReader();
      r.onload = ()=> res(r.result);
      r.onerror = rej;
      r.readAsDataURL(file);
    });

    // Cria imagem para desenhar no canvas
    const img = await new Promise((res, rej)=>{
      const i = new Image();
      i.onload = ()=> res(i);
      i.onerror = rej;
      i.src = dataURL;
    });

    // Calcula crop central quadrado e desenha 512x512
    const canvas = document.createElement("canvas");
    const SIZE = 512;
    canvas.width = SIZE; canvas.height = SIZE;
    const ctx = canvas.getContext("2d");

    const srcW = img.width, srcH = img.height;
    const side = Math.min(srcW, srcH);
    const sx = (srcW - side) / 2;
    const sy = (srcH - side) / 2;

    ctx.drawImage(img, sx, sy, side, side, 0, 0, SIZE, SIZE);

    // Exporta como JPEG de boa qualidade
    const optimized = canvas.toDataURL("image/jpeg", 0.9);

    // Salva no Firestore
    await updateDoc(doc(db,"usuarios",auth.currentUser.uid),{ foto: optimized });

    // Atualiza UI
    fotoPerfil.src = optimized;
    alert("Foto atualizada!");
    inputFoto.value = ""; // limpa seleção
  };

  logoutBtn.onclick = async ()=>{
    await signOut(auth);
    window.location.href = "login.html";
  };
</script>

</body>
</html>