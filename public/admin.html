<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Painel Gestor — Motorista Plus</title>

<style>
:root{
  --bg:#0b0f14;
  --bg2:#10161d;
  --card:#161c23;
  --primary:#f39220;
  --outline:#2b3a49;
  --text:#fff;
  --muted:#b5bcc7;
}

body{
  background: linear-gradient(180deg, var(--bg) 0%, var(--bg2) 100%);
  color: var(--text);
  font-family: system-ui, Arial;
  margin: 0;
  padding: 0;
  min-height: 100vh;
  display:flex;
  flex-direction:column;
}

/* ==================== HEADER ==================== */
header{
  padding:18px;
  background:#000;
  color:#fff;
  font-size:22px;
  font-weight:800;
  border-bottom:1px solid var(--outline);
}
.plus{ color:var(--primary); }

/* ==================== LAYOUT ==================== */
main{
  flex:1;
  display:grid;
  grid-template-columns:280px 1fr;
}

.sidebar{
  border-right:1px solid var(--outline);
  padding:14px;
  overflow-y:auto;
  background:#0c1218;
}

input{
  width:100%;
  padding:12px;
  border-radius:10px;
  border:1px solid var(--outline);
  background:rgba(255,255,255,.10);
  color:#fff;
  font-size:15px;
  margin-bottom:12px;
}

input:focus{
  border-color:var(--primary);
}

/* ==================== LISTA DE MOTORISTAS ==================== */
.motorista-item{
  padding:12px;
  border-radius:10px;
  background:rgba(255,255,255,.04);
  border:1px solid var(--outline);
  margin-bottom:10px;
  cursor:pointer;
  transition:.2s;
}
.motorista-item:hover{
  background:rgba(255,255,255,.10);
}

/* ==================== CONTEÚDO ==================== */
#conteudo{
  padding:20px;
}

.card{
  background:var(--card);
  border:1px solid var(--outline);
  border-radius:14px;
  padding:18px;
  margin-bottom:18px;
}

.card h2{
  margin:0;
  font-size:22px;
  color:var(--primary);
  margin-bottom:10px;
}

.info{
  font-size:16px;
  margin:4px 0;
}

.small{
  font-size:13px;
  color:var(--muted);
  margin-bottom:4px;
}

/* RESPONSIVIDADE */
@media(max-width:820px){
  main{
    grid-template-columns:1fr;
  }
  .sidebar{
    border-right:none;
    border-bottom:1px solid var(--outline);
  }
}
</style>
</head>

<body>

<header>Painel Gestor — Motorista<span class="plus">Plus</span></header>

<main>

<!-- SIDEBAR -->
<div class="sidebar">
  <input id="busca" placeholder="Buscar motorista...">
  <div id="listaMotoristas"></div>
</div>

<!-- CONTEÚDO -->
<div id="conteudo">
  <div class="card">
    <h2>Selecione um motorista</h2>
    <p class="small">Use o campo de busca ao lado para localizar pelo nome.</p>
  </div>
</div>

</main>


<script type="module">
/* ==================== IMPORTS FIREBASE ==================== */
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
import { 
  getFirestore, getDocs, collection, doc, getDoc 
} from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

/* CONFIG DO PROJETO */
const app = initializeApp({
  apiKey:"AIzaSyCnlpnTTJvJPZxuZdmpKQWbbHtvH72nMUU",
  authDomain:"motorista-plus-c53f4.firebaseapp.com",
  projectId:"motorista-plus-c53f4"
});

const auth = getAuth(app);
const db = getFirestore(app);

let motoristas = [];

/* ==================== CARREGAR MOTORISTAS ==================== */
async function carregarMotoristas(){
  const snap = await getDocs(collection(db,"usuarios"));
  motoristas = snap.docs.map(d=>({
    id:d.id,
    ...d.data()
  }));
  renderLista(motoristas);
}

/* ==================== RENDER LISTA ==================== */
function renderLista(lista){
  const box = document.getElementById("listaMotoristas");
  box.innerHTML = "";

  lista.forEach(m => {
    const div = document.createElement("div");
    div.className = "motorista-item";

    div.innerHTML = `
      <strong>${m.nome || "Sem nome"}</strong><br>
      <span class="small">${m.email || ""}</span>
    `;

    div.onclick = () => abrirMotorista(m);
    box.appendChild(div);
  });
}

/* ==================== ABRIR DETALHES ==================== */
function abrirMotorista(m){
  document.getElementById("conteudo").innerHTML = `
    <div class="card">
      <h2>${m.nome}</h2>
      <p class="small">${m.email || ""}</p>

      <p class="info"><strong>Telefone:</strong> ${m.telefone || "—"}</p>
      <p class="info"><strong>CPF:</strong> ${m.cpf || "—"}</p>
      <p class="info"><strong>Cavalo:</strong> ${m.placaCavalo || "—"}</p>
      <p class="info"><strong>Reboque:</strong> ${m.placaReboque || "—"}</p>
    </div>
  `;
}

/* ==================== BUSCA EM TEMPO REAL ==================== */
document.getElementById("busca").addEventListener("input", e =>{
  const termo = e.target.value.toLowerCase();

  const filtrados = motoristas.filter(m =>
    (m.nome || "").toLowerCase().includes(termo)
  );

  renderLista(filtrados);
});

/* ==================== VERIFICAR SE É ADMIN ==================== */
async function validarAdmin(){
  const user = auth.currentUser;

  if(!user){
    window.location.href = "login_admin.html";
    return;
  }

  const docAdmin = await getDoc(doc(db,"admins",user.uid));
  if(!docAdmin.exists()){
    alert("Acesso negado!");
    window.location.href = "login_admin.html";
    return;
  }

  carregarMotoristas();
}

/* MONITORAR LOGIN */
onAuthStateChanged(auth, ()=>{
  validarAdmin();
});
</script>

</body>
</html>
