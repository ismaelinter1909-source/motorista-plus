<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Painel Motorista — Motorista Plus</title>

<style>
  :root{
    --bg:#0b0f14; --bg2:#10161d; --card:rgba(16,22,29,.86);
    --primary:#f39220; --primary-700:#d47e16; --outline:#2b3a49; --text:#fff;
  }
  *{margin:0;padding:0;box-sizing:border-box;font-family:system-ui,Arial}

  body{background:var(--bg);color:var(--text);overflow-x:hidden}

  /* Botão abrir menu */
  #abrirMenu{
    position:fixed; top:15px; left:15px; z-index:9999;
    padding:10px 14px; background:var(--primary); border:none; border-radius:8px;
    color:#fff; font-weight:700; cursor:pointer; transition:.25s;
  }
  #abrirMenu:hover{ background:var(--primary-700); transform:scale(1.05) }

  /* Menu lateral */
  .menu-lateral{
    position:fixed; top:0; left:-330px; width:300px; height:100vh; z-index:9998;
    background:var(--bg2); padding:20px; border-right:1px solid var(--outline);
    transition:.3s;
  }
  .menu-lateral.active{ left:0 }
  .menu-lateral h3{ text-align:center; color:var(--primary); margin-bottom:10px }
  .menu-lateral label{display:block;margin-top:8px;font-size:14px}
  .menu-lateral input{
    width:100%; padding:10px; margin-top:4px; border-radius:10px;
    background:#0f141a; border:1px solid var(--outline); color:#fff;
  }
  .menu-lateral button{
    margin-top:12px; padding:12px; border:none; background:var(--primary);
    color:#fff; font-weight:700; border-radius:10px; cursor:pointer; transition:.25s;
  }
  .menu-lateral button:hover{ background:var(--primary-700); transform:scale(1.05) }

  /* Hero */
  header.hero{
    height:70vh;
    background:
      linear-gradient(180deg,rgba(0,0,0,.35),rgba(0,0,0,.85)),
      url("img/Logo.Motorista-Plus.png") center/cover no-repeat;
    display:flex; flex-direction:column; align-items:center; justify-content:center;
    text-align:center; padding:20px;
  }

  /* Nome Motorista Plus */
  .brand{
    font-size:clamp(38px,6vw,60px);
    font-weight:800;
    color:#fff;
    text-align:center;
  }
  .brand .plus{ color:var(--primary) }

  .slogan{
    font-size:clamp(14px,2vw,20px);
    letter-spacing:.15em;
    margin-bottom:20px;
    opacity:.9;
    color:#fff;
    text-align:center;
  }

  /* Cartão de perfil */
  .card-perfil{
    background:var(--card); border:1px solid var(--outline); border-radius:16px;
    padding:22px; width:min(90%,450px); backdrop-filter:blur(6px);
    box-shadow:0 10px 35px rgba(0,0,0,.35);
    margin-top:10px;
  }

  /* Avatar redondo pequeno */
  .avatar-wrapper{
    display:flex;
    flex-direction:column;
    align-items:center;
    gap:6px;
    margin-bottom:14px;
  }
  .avatar-circle,
  .avatar-img{
    width:80px;
    height:80px;
    border-radius:50%;
    border:2px solid var(--primary);
    object-fit:cover;
    cursor:pointer;
  }
  .avatar-circle{
    display:flex;
    align-items:center;
    justify-content:center;
    background:linear-gradient(135deg,#1c2530,#253446);
    color:#fff;
    font-weight:800;
    font-size:26px;
  }
  .avatar-hint{
    font-size:11px;
    color:#ccc;
  }

  .info{
    background:rgba(255,255,255,.06); border:1px solid var(--outline);
    padding:10px; margin:8px 0; border-radius:10px;
    font-size:14px;
  }

  /* Conteúdo (cards) */
  .conteudo{
    max-width:1100px; margin:80px auto 40px;
    padding:20px;
  }
  .titulo-sessao{
    text-align:center; font-size:22px; color:var(--primary);
    margin-bottom:20px; font-weight:800
  }

  .links-grid{
    display:grid; grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
    gap:18px;
  }
  .links-grid a{
    display:flex; flex-direction:column; align-items:center; gap:12px;
    background:var(--card); border:1px solid var(--outline);
    padding:22px; border-radius:16px; text-decoration:none; color:#fff;
    font-size:18px; font-weight:700;
    transition:transform .15s ease, box-shadow .15s ease;
  }
  .links-grid a:hover{
    transform:translateY(-3px) scale(1.03);
    box-shadow:0 10px 26px rgba(0,0,0,.35);
  }

  .card-icon{ width:48px; height:48px; fill:#fff }

  /* Botão sair */
  #logoutBtn{
    margin:40px auto; background:#d94343; padding:14px 20px;
    border-radius:12px; color:#fff;
    border:none; font-weight:700; cursor:pointer; transition:.25s; display:block; width:220px;
  }
  #logoutBtn:hover{ background:#b93636; transform:scale(1.05) }
</style>

</head>
<body>

<button id="abrirMenu">Perfil</button>

<div class="menu-lateral" id="menuLateral">
  <h3>Editar Perfil</h3>
  <label>Nome</label><input id="editarNome">
  <label>Telefone</label><input id="editarTelefone">
  <label>Placa Cavalo</label><input id="editarPlacaCavalo">
  <label>Placa Reboque</label><input id="editarPlacaReboque">
  <label>Email</label><input id="editarEmail">
  <button id="salvarPerfil">Salvar</button>
</div>

<header class="hero">

  <h1 class="brand">Motorista<span class="plus">Plus</span></h1>
  <p class="slogan">SEMPRE EM MOVIMENTO</p>

  <div class="card-perfil">
    <div class="avatar-wrapper">
      <!-- Círculo com iniciais (fallback) -->
      <div id="avatarCircle" class="avatar-circle">MP</div>
      <!-- Foto do usuário (aparece quando tiver URL) -->
      <img id="userFoto" class="avatar-img" alt="Foto do motorista" style="display:none;">
      <!-- Input oculto para upload -->
      <input type="file" id="inputFoto" accept="image/*" style="display:none;">
      <small class="avatar-hint">Toque na foto para alterar</small>
    </div>

    <h2 id="boasVindas" style="text-align:center;">Bem-vindo(a)</h2>

    <div class="info" id="userNome"></div>
    <div class="info" id="userTelefone"></div>
    <div class="info" id="userPlacaCavalo"></div>
    <div class="info" id="userPlacaReboque"></div>
    <div class="info" id="userEmail"></div>
  </div>
</header>

<div class="conteudo">
  <h2 class="titulo-sessao">Planilhas de Viagem</h2>

  <div class="links-grid">
    <a href="media.html"><svg class="card-icon" viewBox="0 0 24 24"><path d="M3 3h2v18H3zM9 13h2v8H9zM15 8h2v13h-2zM21 3h-2v18h2z"/></svg>Média</a>
    <a href="abastecimentos.html"><svg class="card-icon" viewBox="0 0 24 24"><path d="M3 3h10v18H3zM18 6l3 3v9a3 3 0 1 1-6 0v-7h2v7a1 1 0 1 0 2 0V10l-2-2z"/></svg>Abastecimento</a>
    <a href="gastos.html"><svg class="card-icon" viewBox="0 0 24 24"><path d="M2 7h20v10H2zm3 3v4h14v-4z"/></svg>Gastos</a>
    <a href="viagem.html"><svg class="card-icon" viewBox="0 0 24 24"><path d="M12 2l7 7-7 7-7-7z"/></svg>Viagem</a>
    <a href="entregas.html"><svg class="card-icon" viewBox="0 0 24 24"><path d="M3 5h13v14H3zM16 8h4l1 3v8h-5z"/></svg>Entregas</a>
    <a href="manutencao.html"><svg class="card-icon" viewBox="0 0 24 24"><path d="M12 9a3 3 0 1 1 0 6 3 3 0 0 1 0-6zm9.4 6.2a8 8 0 0 0 .1-3.4l2-1.6-1.5-2.6-2.3.6a8 8 0 0 0-2.4-1.4L16.7 2h-3.4l-.6 2.4a8 8 0 0 0-2.4 1.4l-2.3-.6L5 6.6l2 1.6a8 8 0 0 0 0 3.4l-2 1.6L6.5 17l2.3-.6a8 8 0 0 0 2.4 1.4l.6 2.4h3.4l.6-2.4a8 8 0 0 0 2.4-1.4l2.3.6 1.5-2.6z"/></svg>Manutenção</a>
    <a href="ponto.html"><svg class="card-icon" viewBox="0 0 24 24"><path d="M12 1a11 11 0 1 1 0 22A11 11 0 0 1 12 1zm1 6h-2v7h6v-2h-4z"/></svg>Ponto</a>
  </div>

  <button id="logoutBtn">Sair</button>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
  import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
  import { getFirestore, doc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";
  import { getStorage, ref as storageRef, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-storage.js";

  /* ✅ motorista-plus-c53f4 */
  const firebaseConfig = {
    apiKey: "AIzaSyCnlpnTTJvJPZxuZdmpKQWbbHtvH72nMUU",
    authDomain: "motorista-plus-c53f4.firebaseapp.com",
    projectId: "motorista-plus-c53f4",
    storageBucket: "motorista-plus-c53f4.appspot.com",
    messagingSenderId: "766097061342",
    appId: "1:766097061342:web:36d999bec6d9fe8c46994f"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);
  const storage = getStorage(app);

  const menu = document.getElementById("menuLateral");
  const abrirMenuBtn = document.getElementById("abrirMenu");
  const avatarCircle = document.getElementById("avatarCircle");
  const userFoto = document.getElementById("userFoto");
  const inputFoto = document.getElementById("inputFoto");

  abrirMenuBtn.onclick = ()=> menu.classList.toggle("active");

  onAuthStateChanged(auth, async (user)=>{
    if(!user){ window.location.href="login.html"; return; }

    const refUser = doc(db,"usuarios",user.uid);
    const snap = await getDoc(refUser);

    if(!snap.exists()){ alert("Erro ao carregar perfil."); return; }
    const u = snap.data();

    // Texto de boas-vindas e informações
    boasVindas.textContent = "Bem-vindo(a), " + (u.nome || "");
    userNome.textContent = "Nome: " + (u.nome || "—");
    userTelefone.textContent = "Telefone: " + (u.telefone || "—");
    userPlacaCavalo.textContent = "Placa Cavalo: " + (u.placaCavalo || "—");
    userPlacaReboque.textContent = "Placa Reboque: " + (u.placaReboque || "—");
    userEmail.textContent = "Email: " + (u.email || "—");

    // Preencher campos de edição
    editarNome.value = u.nome || "";
    editarTelefone.value = u.telefone || "";
    editarPlacaCavalo.value = u.placaCavalo || "";
    editarPlacaReboque.value = u.placaReboque || "";
    editarEmail.value = u.email || "";

    // FOTO DE PERFIL
    if (u.fotoUrl) {
      userFoto.src = u.fotoUrl;
      userFoto.style.display = "block";
      avatarCircle.style.display = "none";
    } else {
      userFoto.style.display = "none";
      avatarCircle.style.display = "flex";
      // se tiver nome, mostra iniciais
      if (u.nome) {
        const partes = u.nome.trim().split(" ");
        const iniciais = (partes[0]?.[0] || "") + (partes[1]?.[0] || "");
        avatarCircle.textContent = iniciais.toUpperCase() || "MP";
      }
    }

    // Clique na foto ou no círculo abre o seletor de arquivo
    const abrirUpload = () => inputFoto.click();
    avatarCircle.onclick = abrirUpload;
    userFoto.onclick = abrirUpload;

    // Upload da nova foto
    inputFoto.addEventListener("change", async (e) => {
      const file = e.target.files[0];
      if (!file) return;

      try {
        const caminho = `usuarios/${user.uid}/perfil/foto_${Date.now()}`;
        const fotoRef = storageRef(storage, caminho);

        // Envia arquivo pro Storage
        await uploadBytes(fotoRef, file);

        // Pega URL pública
        const url = await getDownloadURL(fotoRef);

        // Salva URL no Firestore
        await updateDoc(refUser, { fotoUrl: url });

        // Atualiza UI
        userFoto.src = url;
        userFoto.style.display = "block";
        avatarCircle.style.display = "none";

        alert("Foto atualizada com sucesso!");
      } catch (err) {
        console.error("Erro ao enviar foto:", err);
        alert("Erro ao enviar foto. Tente novamente.");
      } finally {
        inputFoto.value = ""; // limpa input
      }
    });

    // Salvar perfil (texto)
    salvarPerfil.onclick = async ()=>{
      await updateDoc(refUser,{
        nome: editarNome.value,
        telefone: editarTelefone.value,
        placaCavalo: editarPlacaCavalo.value,
        placaReboque: editarPlacaReboque.value,
        email: editarEmail.value
      });
      alert("Perfil atualizado!");
      location.reload();
    };
  });

  logoutBtn.onclick = async ()=>{ await signOut(auth); window.location.href="login.html"; };
</script>

</body>
</html>
